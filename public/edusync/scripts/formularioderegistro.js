document.addEventListener('DOMContentLoaded',()=>{ const pw=document.getElementById('password'); const tgl=document.querySelector('.toggle-password'); const form=document.getElementById('registro-form'); const nombre=document.getElementById('nombre'); const tel=document.getElementById('telefono'); const personal=document.getElementById('correo-personal'); const passErr=document.createElement('div'); passErr.className='error-message'; pw.parentNode.insertBefore(passErr,pw.nextSibling); if(tgl){ tgl.addEventListener('click',()=>{ const type=pw.type==='password'?'text':'password'; pw.type=type; const i=tgl.querySelector('i'); i.classList.toggle('fa-eye'); i.classList.toggle('fa-eye-slash'); }); }
 const hints=document.createElement('div'); hints.className='password-hints'; hints.innerHTML='<strong>Contraseña segura:</strong><ul><li data-hint="len">Mínimo 8</li><li data-hint="upper">Una mayúscula</li><li data-hint="lower">Una minúscula</li><li data-hint="num">Un número</li><li data-hint="sym">Un símbolo</li></ul>'; pw.parentNode.appendChild(hints);
 pw.addEventListener('input',()=>{ const v=pw.value; upd('len',v.length>=8); upd('upper',/[A-Z]/.test(v)); upd('lower',/[a-z]/.test(v)); upd('num',/[0-9]/.test(v)); upd('sym',/[@$!%*?&\/\-+]/.test(v)); }); function upd(code,ok){ const li=hints.querySelector('li[data-hint="'+code+'"]'); if(li) li.className= ok?'hint-ok':'hint-bad'; }
 form.addEventListener('submit',async e=>{ e.preventDefault(); let valid=true; if(nombre.value.trim()===''){ err(nombre,'Nombre requerido'); valid=false; } else clearErr(nombre); const telRe=/^[0-9]+$/; if(!telRe.test(tel.value)){ err(tel,'Teléfono inválido'); valid=false; } else clearErr(tel); if(personal.value.trim()!==''){ const re=/^[^@\s]+@[^@\s]+\.[^@\s]+$/; if(!re.test(personal.value.trim())){ err(personal,'Correo personal inválido'); valid=false; } else clearErr(personal); }
 const pVal=pw.value; const pRe=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&\/+-])[A-Za-z\d@$!%*?&\/+-]{8,}$/; if(!pRe.test(pVal)){ passErr.textContent='Contraseña débil.'; pw.classList.add('error'); valid=false; } else { passErr.textContent=''; pw.classList.remove('error'); }
 if(!document.getElementById('terminos').checked){ alert('Acepta términos.'); valid=false; }
 const btn=form.querySelector('button[type="submit"]'); btn.disabled=true; btn.textContent='Registrando...'; if(valid){ const api=window.eduSyncAPI; const payload={ name:nombre.value.trim(), telefono:tel.value.trim(), password:pVal, fecha_nacimiento:document.getElementById('fecha-nacimiento').value||null, direccion:document.getElementById('direccion').value||null, personal_email:personal.value.trim()||null }; try{ const r=await api.register(payload); if(r && r.user){ const correoGen=r.generated_email||r.user.email; try{ showSuccessNotification('Registro OK. Correo: '+correoGen); }catch(_){} setTimeout(()=>{ window.location.href='DashboardAlumno.html'; },800); } else alert('Error en registro'); }catch(err){ if(err.status===422){ const errs=(err.details&&err.details.errors)||err.details||{}; const first=Object.values(errs)[0]; alert(Array.isArray(first)?first[0]:first||'Datos inválidos'); } else alert(err.message||'Error'); } finally { btn.disabled=false; btn.textContent='Registrarse'; } } else { const first=document.querySelector('.error,.error-message'); if(first&&first.scrollIntoView) first.scrollIntoView({behavior:'smooth'}); btn.disabled=false; btn.textContent='Registrarse'; }
 }); function err(el,msg){ const d=document.createElement('div'); d.className='error-message'; d.textContent=msg; el.parentNode.insertBefore(d,el.nextSibling); el.classList.add('error'); } function clearErr(el){ const e=el.parentNode.querySelector('.error-message'); if(e&&e!==passErr) e.remove(); el.classList.remove('error'); }
});