document.addEventListener('DOMContentLoaded',()=>{ const pw=document.getElementById('password'); const tgl=document.querySelector('.toggle-password'); const form=document.getElementById('login-form'); const fb=document.getElementById('login-feedback'); if(tgl){ tgl.addEventListener('click',()=>{ const type=pw.type==='password'?'text':'password'; pw.type=type; const i=tgl.querySelector('i'); i.classList.toggle('fa-eye'); i.classList.toggle('fa-eye-slash'); }); }
  form.addEventListener('submit',async e=>{ e.preventDefault(); const email=document.getElementById('email').value.trim(); const password=pw.value; const api=window.eduSyncAPI; const btn=form.querySelector('button[type="submit"]'); fb.style.display='none'; fb.textContent=''; btn.disabled=true; btn.textContent='Ingresando...'; try{ const r=await api.login({email,password}); if(r&&r.user){ const user=r.user; const base=''; const map={ admin:'DashboardAdmin.html', guardian:'DashboardPadres.html', teacher:'DashboardDocente.html', student:'DashboardAlumno.html'}; window.location.href= base + (map[user.role]||'DashboardAlumno.html'); } else { fb.textContent='Credenciales incorrectas.'; fb.style.display='block'; } }catch(err){ let msg=err.message||'Error al iniciar sesión.'; if(/Failed to fetch|NetworkError/i.test(msg)) msg='No se pudo conectar con backend.'; else if(err.status===401) msg='Email o contraseña inválidos.'; fb.textContent=msg; fb.style.display='block'; } finally { btn.disabled=false; btn.textContent='Ingresar'; }
  }); });